{% extends "base.html" %}
{% block content %}
  <!-- Debug info (hidden) -->
  <div style="display: none">
    <p>Quiz: {{ quiz }}</p>
    <p>Pokemon vars: {{ pokemon_vars }}</p>
  </div>

  <h2>{{ quiz.title }}</h2>
  <p>{{ quiz.description }}</p>

  <form method="POST" action="#quiz-results">
    {# Process each equation and replace placeholders with images #}
    {% for equation in quiz.equations %}
      {% set ns = namespace(equation=equation) %}
      {% for pokemon_name, image_file in pokemon_vars.items() %}
        {% set placeholder = "{" ~ pokemon_name ~ "}" %}
        {% if placeholder in ns.equation %}
          {% set ns.equation = ns.equation | replace(
            placeholder,
            '<img src="/static/images/' ~ image_file ~ 
            '" class="pokemon-var" alt="' ~ pokemon_name ~ 
            '" style="height:30px; display:inline-block;">'
          ) %}
        {% endif %}
      {% endfor %}
      <div class="equation">
        <div style="font-size:1.2em; margin:10px 0;">{{ ns.equation | safe }}</div>
      </div>
    {% endfor %}

    {# Dedicated Answers Section using keys from quiz.answer #}
    <h3>Your Answers</h3>
    <div class="answers-section" style="margin-bottom:20px;">
      {% for unknown, correct_value in quiz.answer.items() %}
        <div>
          <label for="{{ unknown }}">
            <img src="/static/images/{{ pokemon_vars[unknown] }}" class="pokemon-var" alt="{{ unknown }}" style="height:30px; display:inline-block;">
          </label>
          <input type="number" 
                 name="{{ unknown }}" 
                 id="{{ unknown }}" 
                 value="{{ user_answers[unknown] if unknown in user_answers else '' }}"
                 required 
                 style="width:60px; margin:0 5px;">
        </div>
      {% endfor %}
    </div>

    <button type="submit" style="margin-top:20px;">Submit Answers</button>
  </form>

  {% if request.method == 'POST' and result is not none %}
    <div id="quiz-results" style="margin-top:20px;">
      {% if result %}
      <div class="result-correct">
        <h3>Correct!</h3>
      </div>
      <div class="celebration-gif">
        <img src="{{ url_for('static', filename='images/pokeball-1.gif') }}" alt="Celebration pokeball">
      </div>
      {% else %}
      <div class="result-incorrect">
        <h3>Try Again</h3>
      </div>
      {% endif %}
    </div>
  {% endif %}
{% endblock %}
